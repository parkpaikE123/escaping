<html lang="ko" 
		xmlns:th="http://www.thymeleaf.org" 
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/compliance}">
     <div layout:fragment="contents">
		<div class="detail-zone d-flex justify-content-center align-items-center">
			<div>
				<div class="poster-zone d-flex justify-content-center align-items-center">
					<img width="300" height="300" th:src="${theme.imagePath}">
				</div>
				<div class="info-zone mt-4">
					<h2 th:text="${theme.themeName}"></h2>
					<p th:text="${theme.themeStory}"></p>
				</div>
			</div>
		</div>
		<hr>
		<div class="detail-bottom">
			<nav>
				<div class="btn-bar d-flex align-items-center d-none">
					<button class="btn select-menu btn-info form-control col-4" id="infoBtn">정보</button>
					<button class="btn select-menu btn-info form-control col-4" id="reviewBtn">리뷰</button>
					<button class="btn select-menu btn-info form-control col-4" id="comuBtn">커뮤니티</button>
				</div>
				<div class="info-section">
					<b th:text="|가격: ${theme.price}원|">가격</b>
					<br>
					<b th:text="|장르: ${theme.genre}|">가격</b>
					<br>
					<b th:text="|제한시간: ${theme.runningTime}분|">가격</b>
					<br>
					<h3 th:text="|매장: ${theme.branchName}|"></h3>
					<h2>매장위치</h2>
				</div>
				<div class="review-section w-100 d-none">
					<div th:each="review:${reviewList}">
						<div class="review-zone">
							<b><span th:text="${review.reviewUserName}"></span></b>
							<div class="d-flex justify-content-around mb-4">
								<div th:text="${review.contents}" class="mr-4"></div>
								<div th:text="|탈출: ${review.success}|"></div>
								<div th:text="|별점: ${review.point}점|"></div>
								<div th:text="|난이도: ${review.level}|"></div>
								<div th:if="${review.userId==session.userId}">
									<button class="btn delete-review-btn btn-danger form-control" th:data-review-id="${review.id}">삭제하기</button>
								</div>
							</div>
						</div>
					</div>
					<div class="d-flex justify-content-around">
						<div></div>
						<div></div>
						<a class="btn-primary btn form-control col-2" th:href="|/review/create-view?id=${theme.id}|">리뷰 작성하기</a>
					</div>
				</div>
				<div class="comunity-section w-100 text-center d-none">
					<table class="table">
				<thead height=100>
					<tr>
						<th>정보</th>
						<th>구인글</th>
						<th>모집인원</th>
						<th>상태</th>
						<th></th>
					</tr>
				</thead>
				<tbody height=200>
					<tr th:each="community:${communityList}">
						<td th:text="${community.userName}">작성자 이름</td>
						<td th:text="${community.contents}">구인글 자리</td>
						<td th:text="|${community.recruitCount}명|">모집인원 수</td>
						<td th:text="${community.state}">구인중</td>
						<td><a href="*" class="btn btn-info">참여 할게요!</a></td>
					</tr>
				</tbody>
			</table>
					<div class="d-flex justify-content-around">
						<div></div>
						<div></div>
						<a class="btn-primary btn form-control col-2" th:href="|/community/create-view?themeId=${theme.id}|">커뮤니티 작성하기</a>
					</div>
				</div>
			</nav>
		</div>
		<hr>
	</div>
	<script layout:fragment="script">
		$(function() {
			
			$(".delete-review-btn").on("click", function() {
				let id = $(this).data("review-id");
				$.ajax({
					type:"delete"
					,url:"/review/delete"
					,data:{"id":id}
					,success:function(response){
						if(response.result == "success") {
							location.reload();
						} else{
							alert("리뷰 삭제 실패!");
						}
					}
					,error:function(){
						alert("리뷰삭제 에러!");
					}
				});
			});
			
			$("#infoBtn").on("click", function() {
				$(".info-section").removeClass("d-none");
				$(".review-section").addClass("d-none");
				$(".comunity-section").addClass("d-none");
			});
			$("#reviewBtn").on("click", function() {
				$(".review-section").removeClass("d-none");
				$(".info-section").addClass("d-none");
				$(".comunity-section").addClass("d-none");
			});
			$("#comuBtn").on("click",function() {
				$(".comunity-section").removeClass("d-none");
				$(".review-section").addClass("d-none");
				$(".info-section").addClass("d-none");
			});
		});
	</script>
	
</html>